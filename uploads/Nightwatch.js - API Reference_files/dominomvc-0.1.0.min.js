/**
 * dominomvc - v0.1.0 - 2014-01-17
 * http://dominomvc.org
 *
 * Copyright (c) 2014 Andrei Rusu
 * Licensed MIT <https://raw.github.com/beatfactor/dominomvc/master/LICENSE>
 */
!function(a){"use strict";if(a.domino=a.domino||{util:{}},a._)for(var b in _)domino.util[b]=_[b];domino.App=function(a){this.options=a,this.bootstrap=new domino.bootstrap(this.options)},domino.App.prototype.init=function(){this.bootstrap.render()}}(window,document),function(){function a(a){var b=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(a);if(b)return[b[1],Number(b[2])];var c=/at ([^ ]+):(\d+):(?:\d+)$/.exec(a);if(c)return[c[1],Number(c[2])];var d=/.*@(.+):(\d+)$/.exec(a);return d?[d[1],Number(d[2])]:void 0}function b(){if(c)try{throw new Error}catch(b){var d=b.stack.split("\n"),f=d[0].indexOf("@")>0?d[1]:d[2],g=a(f);if(!g)return;return e=g[0],g[1]}}var c=!1;try{throw new Error}catch(d){c=!!d.stack}{var e;b()}}(),domino.util.string={_prepare_str_cache:{},capitalize:function(a){return a=a.charAt(0).toUpperCase()+a.substring(1).toLowerCase()},contains:function(a,b){return a.indexOf(b)>=0},startsWith:function(a,b){return 0===a.indexOf(b)},trim:function(a){return jQuery.trim(a)},prepareStr:function(a){return a=a.toLowerCase(),(this.contains(a,"-")||this.contains(a,"_"))&&(a=this._prepare_str_cache[a]?this._prepare_str_cache[a]:this._prepare_str_cache[a]=domino.util.map(a.split(/-|_/),function(a,b){return 0==b?a:this.capitalize(a)},this).join("")),a},hashCode:function(a){var b,c,d=0;if(0==a.length)return d;for(b=0,l=a.length;l>b;b++)c=a.charCodeAt(b),d=(d<<5)-d+c,d|=0;return d},decodeQueryString:function(a){var b,c,d,e,f=decodeURIComponent,g={},h=a.split("&");for(b=0;b<h.length;b++)c=h[b].split("="),c&&c.length&&(d=c.shift(),e=c.join("=")),c&&d&&(g[f(d)]=f(e));return g}},domino.util.diff=function(a,b){var c={};return domino.util.each(b,function(d,e){e in a&&b[e]==a[e]||(c[e]=b[e])}),c},domino.util.deepClone=function(a){if(!domino.util.isObject(a)||domino.util.isFunction(a))return a;if(domino.util.isDate(a))return new Date(a.getTime());if(domino.util.isRegExp(a))return new RegExp(a.source,a.toString().replace(/.*\//,""));var b=domino.util.isArray(a)||domino.util.isArguments(a),c=function(a,c,d){return b?a.push(domino.util.deepClone(c)):a[d]=domino.util.deepClone(c),a};return domino.util.reduce(a,c,b?[]:{})},domino.util.inArray=function(a,b){return domino.util.indexOf(a,b)>-1},domino.util.array={remove:function(a,b){var c=domino.util.indexOf(a,b),d=c;return d>=0&&a.splice(c,1),d}},domino.util.construct=function(a,b){function c(){var c=this,d=domino.util.map(b,function(a){return a.initModel(c)});return a.apply(this,d)}return c.prototype=a.prototype,new c},domino.util.inherits=function(a,b){if(!b)throw"Invalid source specified";var c=b.prototype,d={};for(var e in a.prototype)d[e]=a.prototype[e];var f=function(){};f.prototype=c,a.prototype=new f;for(var e in d)a.prototype[e]=d[e];return a.prototype.constructor=a,a.prototype.superclass=c,"object"!=typeof b&&c.constructor==Object.prototype.constructor&&(c.constructor=b),a},domino.util.extend=function(a,b){if(!b)throw"Invalid source specified";var c=b.prototype,d=function(){};return d.prototype=c,a.prototype=new d,a.prototype.constructor=a,a.prototype.superclass=c,a.prototype.super=function e(){function a(){var a=this.superclass;if(e.caller===this.constructor)return this.superclass;for(;e.caller!==a.constructor&&a.superclass;)a=a.superclass;return a.superclass}var b=a.call(this);return b.constructor.call(this)},"object"!=typeof b&&c.constructor==Object.prototype.constructor&&(c.constructor=b),a},function(){function a(){this._events=null}function b(a){this.type=a,this.firingStart=!1,this.fired=!1,this.count=0,this.args=null,this.deferred=null,this.listeners=[]}var c=domino.util.isArray;domino.util.EventEmitter=a;var d=10;a.prototype.setMaxListeners=function(a){this._events||(this._events={}),this._maxListeners=a},a.prototype.emit=function(){var a=arguments[0];if("error"===a&&(!this._events||!this._events.error||c(this._events.error)&&!this._events.error.length))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");if(!this._events)return!1;var b=this._events[a];if(!b)return!1;b.firingStart=!0,b.fired=!1,b.deferred=null;for(var d=arguments.length,e=b.args=new Array(d-1),f=1;d>f;f++)b.args[f-1]=e[f-1]=arguments[f];if(1==b.listeners.length&&"function"==typeof b.listeners[0]){var g=b.listeners[0];switch(arguments.length){case 1:g.call(this);break;case 2:g.call(this,arguments[1]);break;case 3:g.call(this,arguments[1],arguments[2]);break;default:g.apply(this,e)}}else for(var h=b.listeners.slice(),f=0,d=h.length;d>f;f++)h[f].apply(this,e);return b.firingStart=!1,b.fired=!0,b.emitter=this,b.count++,this},b.prototype={addListener:function(a,b){if(this.listeners.push(a),!b)return this;if(!this.firingStart&&this.fired&&!this.deferred){var c=this,d=[c.type].concat(c.args);this.deferred=window.setTimeout(function(){c.emitter.emit.apply(c.emitter,d)},0)}}},a.prototype.addListener=function(a,c,e){if("function"!=typeof c)throw new Error("addListener only takes instances of Function");if(this._events||(this._events={}),this.emit("newListener",a,c),this._events[a]||(this._events[a]=new b(a)),this._events[a].addListener(c,e),!this._events[a].warned){var f;f=void 0!==this._maxListeners?this._maxListeners:d,f&&f>0&&this._events[a].length>f&&(this._events[a].warned=!0)}return this},a.prototype.on=a.prototype.addListener,a.prototype.once=function(a,b,c){function d(){e.removeListener(a,d),b.apply(this,arguments)}if("function"!=typeof b)throw new Error(".once only takes instances of Function");var e=this;return d.listener=b,e.on(a,d,c),this},a.prototype.removeListener=function(a,b){if("function"!=typeof b)throw new Error("removeListener only takes instances of Function");if(!this._events||!this._events[a])return this;var d=this._events[a].listeners;if(c(d)){for(var e=-1,f=0,g=d.length;g>f;f++)if(d[f]===b||d[f].listener&&d[f].listener===b){e=f;break}if(0>e)return this;d.splice(e,1),0==d.length}return this},a.prototype.removeAllListeners=function(a){return 0===arguments.length?(this._events={},this):(a&&this._events&&this._events[a]&&(this._events[a]=null),this)},a.prototype.listeners=function(a){return this._events||(this._events={}),this._events[a]}}(),function(a){function b(){this.superclass.constructor.call(this)}function c(){}function d(a,b){this.superclass.superclass.constructor.call(this),this.superclass.constructor.call(this),this.defaults=a.defaults||{},this.url=a.url||"/",this.dataType=a.dataType||"json",this.headers={},this.statusCode={},this._method=b,this.context=a}function e(a){this._id=null,this.__args=[],this.__callbacks=[],this.__filtersDone=[],this.__adapter=null,this._reload=!1,this.ready=!1,this.loading=!1,this.error=!1,this.model=a,this.superclass.superclass.constructor.call(this)}function f(){this.callbacks={result:[]},this.__store={},this.__methods={},this.__custom_adapters={},this.__bindings=null,this.__dependencies=[],this.current_method=null,this.adapter=null,this.setAdapterType()}function g(a,b){this.key=a,this.model=b}domino.util.inherits(b,domino.util.EventEmitter),c.prototype={success:function(){var a=Array.prototype.slice.call(arguments,0);return a.unshift("success"),this.emit.apply(this,a),this},complete:function(){var a=Array.prototype.slice.call(arguments,0);return a.unshift("complete"),this.emit.apply(this,a),this},error:function(){var a=Array.prototype.slice.call(arguments,0);return a.unshift("error"),this.emit.apply(this,a),this},cached:function(){return null}},domino.util.inherits(c,domino.util.EventEmitter),d.prototype={_methods_list:["post","get","head","delete","options","put"],_jsonDataType:function(){return"json"==this.dataType},getStoreKey:function(a){try{var b=decodeURIComponent($.param(a));return b&&(b+="|"),this._method._id+b}catch(c){throw new Error("Constructing the request failed. Check paramters",c)}},getArgs:function(){var a=this._method.getArgs()||[],b=this._method.defaults,c=this.context.defaults,d={};if($.extend(d,c),$.extend(d,b),a.length>0)if(a=a[0],domino.util.isObject(a)){for(var e in a)a[e]instanceof g&&(a[e]=a[e].resolve());$.extend(d,a)}else d[a]="";return d},send:function(a,b){var c=this._method;c.loading=!0;var d=this.getArgs(a),e={url:this.url,type:b||"GET",data:d,context:this.context,headers:this.headers,statusCode:this.statusCode,cache:c.cacheresult};this._method.dataType&&(e.dataType=this._method.dataType);var f=$.ajax(e),g=this;return f.done(function(a,b,e){if(c.cacheresult){c.data=c.data||{};var f=g.getStoreKey(d);c.data[f]=a}var h=domino.util.deepClone(a);domino.util.isFunction(c.done)&&(h=c.done(h)),h=c.__runDoneFilters(h),c.ready=!0,c.jqxhr=e,c.__call(h),c.emit("result",h)}).fail(function(a,b,d){c.error=!0,c.jqxhr=a;var e=a.responseText;if(g._jsonDataType()&&a.responseText)try{e=jQuery.parseJSON(e)}catch(f){}c.emit("error",e,d,b)}).always(function(){c.loading=!1,c._reload=!1,g.complete()}),f}};for(var h=d.prototype,i=0;i<h._methods_list.length;i++)!function(a){var b=h._methods_list[a];h[b]=function(a){return a=a||{},this.send(a,b)}}(i);domino.util.inherits(d,c),e.prototype={args:function(){if(0==arguments.length)return this.__args;for(var a=Array.prototype.slice.call(arguments),b=0;b<a.length;b++)domino.util.isFunction(a[b])&&(a[b]=domino.util.bind(a[b],this));return 1==a.length?(this.__args.push(a[0]),this):(Array.prototype.push.apply(this.__args,a),this)},getStoreKey:function(a){var b=[];return domino.util.each(a,function(a){("string"==typeof a||"number"==typeof a)&&b.push(a)}),0==b.length?this._id:this._id+"|"+b.join("###")},refresh:function(){return this._reload=!0,this.execute()},doneFilter:function(a){var b=domino.controllers.getCurrent(),c=function(){return domino.controllers.wrapAction(b.instance,a,arguments)};return this.__filtersDone.push(c),this},__call:function(){for(var a,b=Array.prototype.slice.call(arguments,0);this.__callbacks.length;)a=this.__callbacks.shift(),a.apply(null,b);return this},__runDoneFilters:function(a){if(this.__filtersDone.length>0){for(var b=a;this.__filtersDone.length;){var c=this.__filtersDone.shift(),d=c(b);domino.util.isUndefined(d)||(b=d)}return b}return a},result:function(a){var b=domino.controllers.getCurrent(),c=function(){return domino.controllers.wrapAction(b.instance,a,arguments)};return this.__callbacks.push(c),this},getArgs:function(){return this.__args},execute:function j(){var b=this.model.initAdapter(this),c=Array.prototype.slice.call(arguments,0);if(!this.method)throw new Error("Request method was not defined!");if(this.loading&&!this.ready)return this;var d=this;if(this.model.__dependencies.length>0){var e=this.model.__dependencies.shift();return this.model.runDependency(e[0],e[1],e[2]).once("result",function(){arguments[0];j.apply(d,c)}),this}for(var f=0;f<c.length;f++)this.__args[f]=c[f]instanceof g?c[f].resolve():c[f];var h=domino.util.isFunction(b.getArgs)?b.getArgs():this.getArgs(),i=domino.util.isFunction(b.getStoreKey)?b.getStoreKey(h):this.getStoreKey(h),k=this.data&&i&&this.data[i];if(!this.loading&&this.ready&&k&&!this._reload){var l=domino.util.clone(k);return a.setTimeout(function(){d.done&&(l=d.done(l)),l=d.__runDoneFilters(l),d.__call(l),d.emit("result",l)},0),this}return b[this.method].apply(b,this.__args),this.__adapter=b,this}},e.extend=function(a,b){var c=function(b){this.superclass.constructor.call(this,b),a.call(this)};return domino.util.inherits(c,e),domino.util.inherits(a,c),new c(b)},domino.util.inherits(e,domino.util.EventEmitter),f.defaultAdapterType="jqHTTP",f.prototype={depends:function(a){var b,c=null;b=domino.util.isArray(a)&&a.length>0?a.shift():a,b&&domino.util.isArray(b)&&b.length>1&&(c=b.slice(1),b=b[0]);var d=b.split("."),e=d[0],f=d[1]||"init";return this.__dependencies.push([e,f,c]),this},runDependency:function(a,c,d){var e=new b;if(a&&c){var f=domino.controllers.getCurrent().instance,g=f.initModel(a),h=d?g[c].apply(g,d):g[c]();h.once("result",function(){var a=Array.prototype.slice.call(arguments,0);a.unshift(this),a.unshift("result"),e.emit.apply(e,a)},h.cacheresult)}return e},setAdapterType:function(){switch(this.adapter_type=this.adapter_type||f.defaultAdapterType,this.adapter_type){case"custom":break;case"jqHTTP":for(var a=this,b=d.prototype._methods_list,c=0;c<b.length;c++)!function(c){var d=b[c];a["$"+d]=function(b){return a.createMethod(b,d)}}(c);this.adapter=function(a,b){return new d(a,b)};break;default:var e=domino.models.getCustomAdapter(this.adapter_type);if(!e)throw new Error("Invalid adapter type specified: "+this.adapter_type);this.adapter=new e(this)}},initAdapter:function(a){var b=this.adapter;return domino.util.isFunction(this.adapter)&&(b=b(this,a)),b},method:function(a){return this.__methods[a]},createMethod:function(a,b){var c=e.extend(a,this);if(!c._id)throw new Error("The method needs an unique id. Please specify the ._id property.");b&&(c.method=b);var d=this;return c.cacheresult=domino.util.isUndefined(c.cacheresult)||c.cacheresult,this.__methods[c._id]=c,function(){var a=this.__methods[c._id];if(d.url&&domino.util.isFunction(d.url)&&(d.url=d.url.apply(d,arguments)),a._events&&a._events.result){var b=c._events.result;b.firingStart=!0,b.args=[],b.fired=!1,b.deferred=null}return a.execute.apply(a,arguments),a}},set:function(a){if(2==arguments.length){var b=arguments[0],c=arguments[1];this.__store[b]=c}else if(1==arguments.length&&"object"==typeof a)for(var b in a)this.set(b,a[b]);return this},get:function(a){return this.__store[a]},resolve:function(a){return new g(a,this)}},g.prototype.resolve=function(){return this.model.get(this.key)},domino.models=new function(){var a={},b=null,d={};this.provide=function(){var b=Array.prototype.slice.call(arguments,0);if(!domino.util.isString(b[0]))throw new Error("first argument needs to be string!");var c=b[0].toLowerCase();if(!domino.util.isFunction(b[1]))throw new Error("second argument needs to be a function!");var d=b[1];if(a[c])throw new Error('a model with the name "'+c+'" has already been defined!');a[c]={fn:d,started:!1,instance:null,name:c}},this.createAdapter=function(){function a(){this.superclass.constructor.call(this)}domino.util.inherits(a,c)},this.run=function(c){function d(){this.superclass.constructor.call(this),g.call(this)}if(domino.util.isUndefined(a[c]))throw new Error("no model defined by this name: "+c);b=a[c];var e;if(b.started)e=b.instance;else{var g=b.fn;domino.util.inherits(d,f),e=b.instance=new d,b._bindings&&b._bindings.length&&b.instance.setupBindings(b._bindings),b.started=!0}return b.instance},this.addAdapter=function(a,b){if(d[a])throw new Error("An adapter with the name "+a+" has already been defined for this model.");d[a]=e(b)},this.getCustomAdapter=function(a){return d[a]};var e=this.createAdapter=function(a){return domino.util.inherits(a,c),a}}}(window,document),function(window,document,undefined){domino.views=new function(){function a(){this._currentView=null,this._currentAction=null,this.__events=null,this.__id=domino.util.uniqueId("_views_"),e[this.__id]={},this.$helper={}}function b(a,b){this.controller=a,this.action=a&&b&&a[b]||null,this.actionName=b,this.previous=null,this["@datastore"]={}}var c,d={},e={},f={},g={},h="/";a.prototype={changeState:function(a,b,c){return domino.viewstates.change(a,b,c),this},renderPartial:function(a){var b=e[this.__id],c=b&&b[this._currentView+"#"+this._currentAction];if(!c)return null;var d=f[this.__id],g=d&&d._options[this._currentAction]||{},h=c.options;h.partial=!0,h.partial_options={container:a};var i;if(domino.util.isObject(arguments[1])){var j=arguments[1];for(var k in j)h.partial_options[k]=j[k];domino.util.isFunction(arguments[1])&&(i=arguments[1])}return domino.util.isFunction(arguments[2])&&(i=arguments[2]),i&&(h.partial_options.callback=i),d&&domino.util.forEach(this.$scope,function(a,b){d.assign(b,a)}),this.render(this._currentView,this._currentAction,{},d),domino.controllers.wrapAction(d,this._currentAction+"Action",[g]),this},navigateTo:function(a){window.history.pushState("","Title",a),$(window).trigger("popstate")},initHelper:function(){var a=Array.prototype.slice.call(arguments,0);if(0==a.length)throw new Error("view helper name needs to be specified!");if(!domino.util.isString(a[0]))throw new Error("view helper name needs to be string!");var b=a.shift(),c=domino.viewhelpers.run(b,this,a);return this.$helper[b]=c,c},getViewArgs:function(){var a={},b=this;return c._vars&&c._vars.length>0&&domino.util.forEach(c._vars,function(c){a[c]=b[c]}),a},updateViewArgs:function(a){for(var b in a)-1==domino.util.indexOf(c._vars,b)&&domino.views.assignVar(b,a[b])},handleViewScope:function(a,b,c,d){var e=d&&d.view,f=this;if(e){if(e.previous&&domino.util.isEqual(e.previous,e["@datastore"]))return;for(var g in e["@datastore"]){var h=e["@datastore"][g];h instanceof domino.util.EventEmitter?(!function(b,g){b.once("result",function(b){var h=domino.controllers.getCurrent().instance.currentAction;d.assign(g,b),f.render(a,h,c,d),e["@datastore"][g]=b})}(h,g),delete e["@datastore"][g]):d.assign(g,h)}e.previous=domino.util.clone(e["@datastore"])}},getRenderer:function(a,b){var c=e[this.__id][a+"#"+b];return c},render:function(a,b,c,d){var g=this.getViewArgs(),h=this.getRenderer(a,b);return f[this.__id]=d,h?h.setOptions(c):h=e[this.__id][a+"#"+b]=new domino.views.ViewRenderer(a,b,c,this),g.self=this,h.options.partial?h.renderPartial(h.options.partial_options,g):h.renderViewScript(g,d),this._currentView=a,this._currentAction=b,this}},b.prototype={set:function(a,b){return this["@datastore"][a]=b,this},keys:function(){if(Object.hasOwnProperty("keys"))return Object.keys(this["@datastore"]);var a=[];for(var b in this["@datastore"])a.push(b);return a},get:function(a){return this["@datastore"][a]}},this.viewScope=b,this.define=function(){var a=Array.prototype.slice.call(arguments,0);if(!domino.util.isString(a[0]))throw new Error("first argument needs to be string!");var b=a[0].toLowerCase();if(!domino.util.isFunction(a[1]))throw new Error("second argument needs to be a function!");var c=a[1];if(d[b])throw new Error('a view with the name "'+b+'" has already been defined!');d[b]={fn:c,started:!1,instance:null,name:b}},this.has=function(a){return!domino.util.isUndefined(d[a])},this.run=function(b,e){if(domino.util.isUndefined(d[b]))throw new Error("no view defined by this name: "+b);c=d[b];var f;return c.started?f=c.instance:(domino.util.inherits(c.fn,a),f=c.instance=new c.fn(e),f.superclass.constructor.call(f),domino.events.provide(b,f),domino.events.run(b),c.started=!0),c.instance},this.assignVar=function(a,b){if(!domino.util.isUndefined(c)){var d=!1;if(c._vars&&domino.util.inArray(c._vars,a)&&(d=!0),!domino.util.isUndefined(c.instance[a])&&!d)throw new Error("Invalid variable name: "+a+". Please use a different one.");c.instance[a]=b,c._vars=c._vars||[],d||c._vars.push(a)}},this.getCurrent=function(){return c},this.getFilter=function(a){return g[a]},this.setFilter=function(a,b){return g[a]||(g[a]=b),swig.setFilter(a,b)},this.setCustomTag=function(a){if(!a||!domino.util.isObject(a))throw new Error("tag definition object missing!");if(!domino.util.isString(a.name))throw new Error("tag name must be defined.");if(!domino.util.isFunction(a.parse))throw new Error("parse method must be a function.");if(!domino.util.isFunction(a.compile))throw new Error("compile method must be a function.");swig.setTag(a.name,a.parse,a.compile,a.ends||!1,a.blockLevel||!1)},this.setBasePath=function(a){return h=a,this},this.getBasePath=function(){return h}},domino.viewhelpers=new function(){var a={};this.define=function(){var b=Array.prototype.slice.call(arguments,0);if(!domino.util.isString(b[0]))throw new Error("first argument needs to be string!");var c=b[0].toLowerCase();if(!domino.util.isFunction(b[1]))throw new Error("second argument needs to be a function!");if(a[c])throw new Error('a view helper with the name "'+c+'" has already been defined!');{var d=b[1];!function(){return d.hasOwnProperty("beforeInit")&&d.beforeInit(),d}()}a[c]={fn:d,started:!1,instance:null,name:c}},this.run=function(b,c,d){if(domino.util.isUndefined(a[b]))throw new Error("no view helper defined by this name: "+b);var e,f=a[b];return f.started?e=f.instance:(f.started=!0,e=f.instance=new f.fn(c.$scope),e.view=c,domino.util.isFunction(e.init)&&e.init.apply(e,d)),e}},domino.views.setCustomTag({name:"include_partial",parse:function(a,b,c,d,e,f){var g,h,i="ignore",j="missing",k="only";return c.on(d.STRING,function(a){return g?!0:(g=a.match,this.out.push(g),void 0)}),c.on(d.VAR,function(a){if(!g)return g=a.match,!0;if(!h&&"with"===a.match)return h=!0,void 0;if(h&&a.match===k&&"with"!==this.prevToken.match)return this.out.push(a.match),void 0;if(a.match===i)return!1;if(a.match===j){if(this.prevToken.match!==i)throw new Error('Unexpected token "'+j+'" on line '+b+".");return this.out.push(a.match),!1}if(this.prevToken.match===i)throw new Error('Expected "'+j+'" on line '+b+' but found "'+a.match+'".');return!0}),c.on("end",function(){this.out.push(f.filename||null)}),!0},compile:function compile(compiler,args){var file=args[0],file_include=eval(file),w=args.slice(1).join(""),ctx="_utils.extend({}, _ctx, "+w+")";return"_output += '<div data-include-partial=\""+file_include+"\"></div>';\n"}}),domino.views.setCustomTag({name:"initHelper",parse:function(a,b,c,d){return c.on("*",function(a){if(a.type!==d.WHITESPACE&&a.type!==d.PARENOPEN&&a.type!==d.PARENCLOSE&&a.type!==d.COMMA){if(a.type===d.STRING)return this.out.push(this.filters.addslashes(a.match)),void 0;if(a.type===d.NUMBER)return this.out.push(a.match),void 0;if(a.type===d.CURLYOPEN)return this.state.push(a.type),void 0;if(a.type!==d.CURLYCLOSE);else if(this.state.pop()!==d.CURLYOPEN)throw new Error("Unexpected closing curly brace")}}),c.on("end",function(){}),!0},compile:function(a,b){var c=b[0];if(c){var d=Array.prototype.slice.call(b,1);return"_output += 'data-helper=\""+c.replace(/\\'/g,"")+"|"+d.join("|")+"\"';\n"}}})}(window,document),function(window,document,undefined){function ViewRenderer(a,b,c,d){this.view=a,this.action=b,this.options=c||{},this.view_instance=d,this.controller=null,this.view_content={container:null,content:"",loading:!1,promise:null,parsed:{},partials:{}},this.eventbus=new domino.eventmanager.EventBus(this)}ViewRenderer.prototype={parseTemplate:function(a){var b=this.view_content.compiled(this.view_args);this.view_instance.updateViewArgs(this.view_args),a.innerHTML=b},setOptions:function(a){for(prop in a)this.options[prop]=a[prop];return this},getContainer:function(){return this.view_content.container&&$(this.view_content.container)},getContent:function(){return this.view_content.container&&this.view_content.container.content},clear:function(){if(this.view_content.container){var a=this.view_content.container.parentNode;a&&a.removeChild(this.view_content.container)}},renderViewScript:function(a,b){if(this.view_args&&domino.util.isEqual(this.view_args,a))return this;this.eventbus.setController(b),this.view_args=a||{};var c=this,d=domino.util.isUndefined(this.options.no_render)||!this.options.no_render;if(!d)return this;var e=this.options.$template&&$(this.options.$template);return e&&e.length>0&&d?(this.view_content.compiled=swig.compile(e.text()),this.renderTemplate()):this.view_content.compiled?this.renderTemplate():this.downloadViewScript(function(){c.renderTemplate()}),this},downloadViewScript:function(a){var b=this,c=domino.views.getBasePath(),d=c+this.view+"/"+this.action+".html",e=this.view_content;return e.loading?e.promise:(e.promise=$.get(d).done(function(c){b.view_content.compiled=swig.compile(c),e.content=c,e.loading=!1,e.promise=null,a()}).fail(function(){b.view_content=null}),e.loading=!0,e.promise)},renderTemplate:function(){var a,b=this.options.$container&&$(this.options.$container),c=b&&b.length>0,d=(""!=this.view_content.content,this.options.$tagName||"div");a=document.createElement(d),this.options.$className&&(a.className=this.options.$className),this.options.$id&&(a.id=this.options.$id),this.parseTemplate(a),this.parseCustomTags(a),c?b.empty().append($(a).contents()):(b=$(a),this.options.$insertBefore?b.insertBefore($(this.options.$insertBefore)):document.body.appendChild(a)),this.view_content.$container=b[0],this.view_instance.$element=b,this.addEventHandlers(b[0]),this.executeViewHelpers(b[0]),this.parseViewBindings(b),this.parseIncludeTags(b),domino.util.isFunction(this.options.render)&&this.options.render.call(this.view_instance,b)},renderPartial:function(a,b){var c=this.getContainer().find(a.container),d=this.view_content.content,e="";if(d){var f=document.createElement("div");f.innerHTML=d;var g=$(f).find(a.container);e=g.html()}if(e){var h=swig.render(domino.util.unescape(e),{locals:b}),i=domino.util.isUndefined(a.replace)||a.replace,j=a.append,k=a.preserve,l=$("<div></div>").append(h);return k&&(domino.util.isArray(k)||(k=[k]),this.preserveNodes(l,k)),this.parseCustomTags(l[0]),h=l.html(),a.element&&(c=$(a.element),h=l.find(a.element).html()),i?c.empty().append(h):j&&c.append(h),this.updateEventHandlers(c),this.parseViewBindings(c),this.parseIncludeTags(c),domino.util.isFunction(a.callback)&&a.callback.call(this.view_instance,l,c),this}},preserveNodes:function(a,b){for(var c={PREPEND:"prepend",APPEND:"append"},d=c.APPEND,e=0;e<b.length;e++){var f=b[e].selector||b[e].element;f instanceof jQuery||(f=$(f));var g=f.html(),h=f.selector;if(g&&h){var i=b[e].method||d;if(!domino.util.findWhere(c,i))throw new Error("Invalid preserve method: "+i+"! Valid methods are: prepend | append");a.find(h)[i](g)}}},executeViewHelpers:function(a){var b=this;$(a).find("[data-helper]").each(function(){var a=$(this),c=a.attr("data-helper");if(c){var d=c.split("|");d.splice(1,0,a);var e=b.view_instance.initHelper.apply(b.view_instance,d);e.render&&domino.util.isFunction(e.render)&&e.render(),a.removeAttr("data-helper")}})},updateViewBindings:function(a){var b=this;$(this.view_content.container).find("[data-bind]").each(function(){var c=$.trim(this.getAttribute("data-bind")),d=this.value||"";try{var e=c.split("|"),f=e.shift();e.length>0&&d&&(d=b.applyFilters(d,e,this)),a[f]=d}catch(g){}})},parseViewBindings:function(a){var b=this;a.find("[data-bind]").each(function(){var a=$.trim(this.getAttribute("data-bind"));try{var c=a.split("|"),d=c.shift();this.value=b.view_args[d]||this.value||""}catch(e){}})},applyFilters:function(a,b,c){for(var d=a;b.length>0;){var e=b.shift(),f=domino.views.getFilter(e);f&&(d=f.call(c,d))}return d},addEventListener:function(a,b,c){return this.eventbus.bind(a,b,c),this},addEventHandlers:function(a){var b=this;this.eventbus.setElement(a),$(a).find("[data-bind-event]").each(function(){var a=this,c=$(a),d=c.attr("data-bind-event");if(d){var e=d.split("|");if(e.length>=2){var f=e.shift(),g=e.shift();e.unshift(a);var h=domino.util.isFunction(b.view_instance[g]);if(!h)throw new Error("No event handler defined by this name: "+g);c.removeAttr("data-bind-event"),b.addEventListener(f,g,e)}}}),$(a).find("[data-bind-click]").each(function(){var a=this,c=$(a),d="click",e=b.parseEventHandlerData(d,c);if(e&&2==e.length){var f=e[0],g=e[1],h=domino.util.isFunction(b.view_instance[f]);if(!h)throw new Error("No event handler defined by this name: "+f);c.removeAttr("data-bind-click"),b.addEventListener(d,f,g)}})},parsePartialTemplate:function(a,b,c,d){var e=a(this.view_args);b.replaceWith(e),c&&d&&d()},parseIncludeTags:function(a){var b,c,d=a.find("[data-include-partial]"),e=d.length,f=this;domino.util.isFunction(this.options.render)&&e>0&&(c=f.options.render,b=function(){c.call(f.view_instance,a)},this.options.render=function(){});var d=a.find("[data-include-partial]"),e=d.length;d.each(function(a){var c=this,d=$(c),g=d.attr("data-include-partial");if(g){var h=a==e-1,i=f.view_content.partials[g];domino.util.isFunction(i)?f.parsePartialTemplate(i,d,h,b):domino.util.isObject(i)&&i.readyState&&4!=i.readyState?i.done(function(){var a=f.view_content.partials[g];f.parsePartialTemplate(a,d,h,b)}):f.view_content.partials[g]=$.get(g).done(function(a){var c=swig.compile(a);f.view_content.partials[g]=c,f.parsePartialTemplate(c,d,h,b)}).fail(function(){throw new Error("Error including partial from: "+g)})}})},parseEventHandlerData:function(a,b){var c=b.attr("data-bind-click");if(!c)return null;var d=c.split(/\((.+)\)/i);d=d.map(function(a){return domino.util.string.trim(a)});var e,f=d[0];return d.length>1?(e=d[1].split(","),e=e.map(function(a){return domino.util.string.trim(a)})):e=[],e.unshift(b[0]),[f,e]},updateEventHandlers:function(a){var b=this;a.find("[data-bind-event]").each(function(){var a=$(this);a.removeAttr("data-bind-event")}),a.find("[data-bind-click]").each(function(){var a=this,c=$(a),d="click",e=b.parseEventHandlerData(d,c);e&&2==e.length&&(c.removeAttr("data-bind-click"),b.addEventListener(d,e[0],e[1]),b.eventbus.cleanupElements(d,e[0]))})},parseCustomTags:function(container){for(var self=this,custom_tags=["dm:debug"],tags=container.getElementsByTagName("dm:debug"),i=0;i<tags.length;i++){var debugentry=tags[i];$(debugentry).children().each(function(){var caption=this.getAttribute("caption")||"",method=this.nodeName.toLowerCase(),content=this.innerHTML;content="self.view_args."+content,console[method](caption,eval(content))}),debugentry.parentNode.removeChild(debugentry)}}},domino.views.ViewRenderer=ViewRenderer}(window,document),function(){function a(){var a=Array.prototype.slice.call(arguments,0);if(0==a.length)throw new Error("model name needs to be specified!");if(!domino.util.isString(a[0]))throw new Error("model name needs to be string!");var b=a.shift();return[b,a]}function b(a){var b=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm,c=a.toString().replace(b,""),d=c.slice(c.indexOf("(")+1,c.indexOf(")")).match(/([^\s,]+)/g);return d}function c(){this.superclass.constructor.call(this)}function d(a){this.context=null,this.model=a||null}domino.util.inherits(c,domino.util.EventEmitter),d.prototype={initModel:function(b){var c=this;this.context=b;var d=(a(this.model),domino.models.run(this.model));return d.after=function e(a,b,f){var g,h=null;f=f||[],g=domino.util.isArray(a)&&a.length>0?a.shift():a,g&&domino.util.isArray(g)&&g.length>1&&(h=g.slice(1),g=g[0]);var i=g.split("."),j=i[0],k=i[1]||"init";return c.runDependencies(j,k,h).once("result",function(){var d=arguments[0];f.push(d.model),domino.util.isArray(a)&&a.length>0?e(a,b,f):domino.controllers.wrapAction(c.context,b,f)}),d},d},runDependencies:function(a,b,d){var e=new c;if(a&&b){var f=this.context.initModel(a),g=d?f[b].apply(f,d):f[b]();g.once("result",function(){var a=Array.prototype.slice.call(arguments,0);a.unshift(this),a.unshift("result"),e.emit.apply(e,a)},g.cacheresult)}return e}},domino.controllers=new function(){function c(){}var e={},f=null;c.prototype={model:function(){var b=a.apply(null,arguments);return domino.models.run(b[0],b[1])},initModel:function(a){var b=a+"Model",c=new d(a);return this[b]=c.initModel(this),this[b]},changeState:function(a,b,c){return domino.viewstates.change(a,b,c),this},assign:function(a,b){return domino.views.assignVar(a,b),this},render:function(a){if(f){a=a||this.currentAction;var b=domino.views.getCurrent();b&&b.instance&&b.started&&b.instance.render(f.name,a,{},f.instance)}}},this.wrapAction=function(a,b,c){var d;d=domino.util.isString(b)?a[b].apply(a,c):b.apply(a,c);var e=a.view;if(e){for(var f in e["@datastore"]){var g=e["@datastore"][f];g instanceof domino.util.EventEmitter?(!function(a,b){a.once("result",function(a){var c=domino.controllers.getCurrent().instance;c.assign(b,a);var d=c.currentAction;c.render(d),e["@datastore"][b]=a},a.cacheresult)}(g,f,a),delete e["@datastore"][f]):a.assign(f,g)}if(e.previous&&domino.util.isEqual(e.previous,e["@datastore"]))return d;e.previous=domino.util.clone(e["@datastore"])}return d},this.inherits=function(a,b,d){if(domino.util.isUndefined(e[b]))throw new Error("no controller defined by this name: "+b);domino.util.inherits(e[b].fn,c),domino.util.inherits(d,e[b].fn),domino.controllers.define(a,d,!0)},this.define=function(){var a=Array.prototype.slice.call(arguments,0);if(!domino.util.isString(a[0]))throw new Error("first argument needs to be a string!");var b=a[0].toLowerCase();if(!domino.util.isFunction(a[1]))throw new Error("second argument needs to be a function!");
var c=a[1],d=a[2]||!1;if(e[b])throw new Error('a controller with the name "'+b+'" has already been defined!');e[b]={fn:c,started:!1,instance:null,name:b,extended:d}},this.has=function(a){return!domino.util.isUndefined(e[a])},this.run=function(a){if(domino.util.isUndefined(e[a]))throw new Error("no controller defined by this name: "+a);f=e[a];var g;if(f.started)g=f.instance;else{f.extended||domino.util.inherits(f.fn,c);var h=[],i=b(f.fn);if(i&&i.length)for(var j=0;j<i.length;j++)if(0==i[j].indexOf("$")){var k=i[j].substring(1),l=new d(k);h.push(l)}g=f.instance=h.length>0?domino.util.construct(f.fn,h):new f.fn,g["@id"]=a+"-controller",i&&i.length&&domino.util.forEach(i,function(a,b){g[a.substring(1)+"Model"]=h[b]}),f.started=!0}return f.instance},this.getCurrent=function(){return f}}}(window,document),function(){function a(a,b,c,d){return a instanceof RegExp?a:(a=a.concat(d?"":"/?").replace(/\/\(/g,"(?:/").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?/g,function(a,c,d,e,f,g){return b.push({name:e,optional:!!g}),c=c||"",""+(g?"":c)+"(?:"+(g?c:"")+(d||"")+(f||d&&"([^/.]+?)"||"([^/]+?)")+")"+(g||"")}).replace(/([\/.])/g,"\\$1").replace(/\*/g,"(.*)"),new RegExp("^"+a+"$",c?"":"i"))}domino.router=function(a){this.controller=null,this.action=null,this.options=a,this.currentController=null,this.actionName="",this.routes=[],this.params=null,this.named_params=!1,a.routes&&this.setupRoutes(a.routes)},domino.router.prototype.routeUrl=function(){try{this.route()}catch(a){a instanceof domino.util.NotFoundError&&(location.href="/404.html")}},domino.router.prototype.route=function(){var a=this.controller,c=this.action,d=this.params;this.currentController=domino.controllers.run(a);var e={fragment:this.fragment,query:this.query,params:this.params};this.currentController.params=d,this.currentController.view=new domino.views.viewScope(this.currentController,c),this.currentController.$view=this.currentController.view["@datastore"],this.currentController.currentAction=this.actionName,this.currentController.fragment=this.fragment||{},this.currentController.query=this.query||{},this.currentController._options={};var f,g=domino.util.isFunction(this.currentController[c]);if(g&&(f=this.currentController._options[this.actionName]={}),domino.util.isFunction(this.currentController.init)&&this.currentController.init(f),domino.util.isFunction(this.currentController[c]))this.currentController[c].call(this.currentController,f,e);else if(this.options.throw_exceptions)throw new b("An action does not exist with this name for the current controller: "+c)},domino.router.prototype.parseUrl=function(a){var b=domino.util.string.contains(a,"#"),c=domino.util.string.contains(a,"?");if(this.query=null,this.fragment=null,b){var d=a.substring(a.indexOf("#")+1);this.fragment=domino.util.string.decodeQueryString(d),a=a.substring(0,a.indexOf("#"))}if(c){var e=a.substring(a.indexOf("?")+1);this.query=domino.util.string.decodeQueryString(e),a=a.substring(0,a.indexOf("?"))}var f=this.find(a);if(this.params=null,this.actionName=null,f){this.controller=f.controller,this.action=f.action.concat("Action"),this.actionName=f.action,this.named_params=!0,this.params={};var g=a.match(f.regex);if(g&&g.length>1)for(var h=1;h<g.length;h++){this.params[f.keys[h-1].name]=g[h]}}else{this.named_params=!1,this.params=[];for(var i,j=a.split("/"),k=null,l=null,h=0;h<j.length;h++)if(i=j[h]){if(!k){k=i;continue}if(!l){this.actionName=i,l=i.toLowerCase().concat("Action");continue}i=i.replace(/(.+)\.[^.]+$/,"$1"),this.params.push(i)}this.controller=k||"index",this.action=l||"indexAction",this.actionName=this.actionName||"index"}},domino.router.prototype.setupRoutes=function(b){domino.util.each(b,function(b){var c={};c.keys=[],c.controller=b.defaults.controller,c.action=b.defaults.action||"index",c.regex=a(b.route,c.keys,!1,!0),this.routes.push(c)},this)},domino.router.prototype.find=function(a){for(var b=0,c=this.routes.length;c>b;b++){var d=this.routes[b];if(d.regex.test(a))return d}return!1};var b=domino.util.NotFoundError=function(a){this.super.apply(this,arguments),this.message=a};domino.util.extend(domino.util.NotFoundError,Error)}(window,document),function(a,b){domino.eventmanager=new function(){function a(){b.body.addEventListener("click",function(a){c("click",a)},!1),b.body.addEventListener("submit",function(a){a.preventDefault(),c("submit",a)},!1)}function c(a,b){var c,d=b.target;return d.hasAttribute("id")?(c=domino.util.string.prepareStr(d.getAttribute("id")),domino.events.call(c,b)):void 0}return{setup:a}},domino.events=new function(){var a={},b=null;this.provide=function(){var b=Array.prototype.slice.call(arguments,0);if(!domino.util.isString(b[0]))throw new Error("first argument needs to be string!");var c=b[0].toLowerCase(),d=b[1];if(a[c])throw new Error('an event provider with the name "'+c+'" has already been defined!');a[c]={started:!1,instance:d,name:c}},this.run=function(c){if(domino.util.isUndefined(a[c]))throw new Error("no event provider defined by this name: "+c);return b=a[c],b.started||(b.started=!0),b.instance},this.hasProvider=function(b){return!domino.util.isUndefined(a[b])},this.call=function(a,c){var d=[a,domino.util.string.capitalize(c.type),"Handler"].join("");if(!domino.util.isUndefined(b.instance[d])){var e=b.instance;if(e&&e._currentView&&e._currentAction){var f=e.getRenderer(e._currentView,e._currentAction);f&&f.updateViewBindings(e.$scope)}return e[d].call(e,c)}return null},this.provider=function(a){return this.run(a)}},domino.eventmanager.EventBus=function(a){this.view=a.view_instance,this.element=null,this.renderer=a,this.controller=null,this.__events={},this.__delegators={},this.__elements=[]},domino.eventmanager.EventBus.prototype={setController:function(a){return this.controller=a,this},setElement:function(a){if(a){$(this.element).off(),this.__events={},this.__delegators={}}return this.element=a,this},bind:function(a,b,c){var d=c[0];return this.isRegistered(a,d,b)?this:(this.registerHandler(a,b,c),void 0)},isRegistered:function(a,b,c){if(this.__events[a]){var d=this.__events[a];if(d&&d.length>0){var e=domino.util.findWhere(d,{handler:c,element:b});if(e)return!0}}return!1},getRegisteredHandlers:function(a,b){return this.__events[a]?domino.util.where(this.__events[a],{element:b}):null},registerHandler:function(a,b,c){this.__delegators[a]||this.addDelegator(a),this.__events[a]||(this.__events[a]=[]);var d={element:c[0],handler:b,args:c.slice(1)};this.__events[a].push(d),this.__elements.push(c[0])},addDelegator:function(a){var b=this,c=this.__delegators[a]=function(c){var d=c.target,e=b.getRegisteredHandlers(a,d);e&&e.length&&b.executeHandlers(e,c)};$(this.element).on(a,c)},callHandler:function(a,b){var c=this.view[a.handler],d=a.args.slice(0);b.target!=a.element&&(a.element=b.target),"event"==d[0]&&(d[0]=b),c.apply(this.view,d)},executeHandlers:function(a,b){var c=this;if(1==a.length)return c.callHandler(a[0],b),void 0;for(var d=0;d<a.length;d++)!function(d){var e=a[d];c.callHandler(e,b)}(d)},cleanupElements:function(a,c){for(var d=domino.util.filter(this.__elements,function(a){return!$.contains(b.documentElement,a)}),e=0;e<d.length;e++){var f=domino.util.findWhere(this.__events[a],{element:d[e],handler:c});domino.util.array.remove(this.__events[a],f),domino.util.array.remove(this.__elements,d[e])}}}}(window,document),function(a){var b=a.history.pushState&&domino.util.isFunction(a.history.pushState);domino.bootstrap=function(a){this.options=a,a.views_path&&domino.views.setBasePath(a.views_path),this.router=new domino.router(a),this.currentView=null,this.supportsPushState=b,this.boot()},domino.bootstrap.prototype.boot=function(){return domino.eventmanager.setup(),this.setupPushStateListener(),this.handleUrl(),this},domino.bootstrap.prototype.setupPushStateListener=function(){var c=this;$(a).bind("popstate",function(a){c.handlePushState(a)}),$("body").on("click","a",function(d){if(b&&!d.isDefaultPrevented()){var e=$(this).attr("href"),f=location.protocol+"//"+location.host;(!domino.util.string.startsWith(e,"http://")&&!domino.util.string.startsWith(e,"https://")||0===f.indexOf(e))&&(d.preventDefault(),a.history.pushState("","Title",e),c.handlePushState(d))}})},domino.bootstrap.prototype.handleUrl=function(){var a=location.pathname+location.search+location.hash;this.router.parseUrl(a);var b=!1,c=!1,d=this.router.controller;if(domino.views.has(d)&&(this.currentView=domino.views.run(d),b=!0),d&&domino.controllers.has(d)&&(this.router.routeUrl(),c=!0),!b&&!c)throw new domino.util.NotFoundError("Controller does not exist with this name: "+d)},domino.bootstrap.prototype.handlePushState=function(a){this.handleUrl(),this.render(a)},domino.bootstrap.prototype.render=function(a){var b=this.router.controller;if(this.currentView){a&&(this.currentView.$event=a);var c=this.router.actionName,d=this.router.currentController&&this.router.currentController._options[c]||{},e={};this.currentView.$scope=this.router.currentController&&this.router.currentController.$view,domino.util.isFunction(this.currentView.init)&&this.currentView.init(d),domino.util.isFunction(this.currentView[c.toLowerCase()+"View"])&&this.currentView[c.toLowerCase()+"View"](e);var f=domino.util.isUndefined(d.script_render)||d.script_render;f&&(this.currentView.handleViewScope(b,c,e,this.router.currentController),this.currentView.render(b,c,e,this.router.currentController))}}}(window,document);